<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invitación ✉️</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./assets/favicon_io/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./assets/favicon_io/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./assets/favicon_io/favicon-16x16.png"
    />
    <link rel="manifest" href="./assets/favicon_io/site.webmanifest" />
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: radial-gradient(circle, #1dc1d0 0%, #0257a7 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      /* Contenedor del sobre */
      .envelope {
        width: 250px;
        height: auto;
        animation: pulse 2s ease-in-out 3; /* palpita más lento y 3 veces */
        z-index: 3;
        position: relative;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
      }

      /* Zoom hacia la cámara */
      .zoom {
        animation: zoomIn 2.5s forwards;
      }
      @keyframes zoomIn {
        to {
          transform: scale(7);
          opacity: 0;
        }
      }

      /* Canvas de partículas */
      canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      /* Flash de luz */
      .flash {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        opacity: 0;
        z-index: 4;
        pointer-events: none;
      }
      .flash.active {
        animation: flashEffect 0.8s forwards;
      }
      @keyframes flashEffect {
        0% {
          opacity: 0;
        }
        30% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <canvas id="particles"></canvas>
    <img
      src="./assets/img/sobre.png"
      class="envelope"
      id="envelope"
      alt="Sobre"
    />
    <div class="flash" id="flash"></div>

    <script>
      const canvas = document.getElementById("particles");
      const ctx = canvas.getContext("2d");
      canvas.width = innerWidth;
      canvas.height = innerHeight;

      class Particle {
        constructor(
          x,
          y,
          color,
          size,
          velocity,
          life = 200,
          isFloating = false,
          sparkle = false
        ) {
          this.x = x;
          this.y = y;
          this.color = color;
          this.size = size;
          this.velocity = velocity;
          this.life = life;
          this.isFloating = isFloating;
          this.sparkle = sparkle;
        }
        update() {
          this.x += this.velocity.x;
          this.y += this.velocity.y;

          if (!this.isFloating) {
            this.life -= 2;
          } else {
            // Reposicionar si se sale de pantalla
            if (this.x < 0) this.x = canvas.width;
            if (this.x > canvas.width) this.x = 0;
            if (this.y < 0) this.y = canvas.height;
            if (this.y > canvas.height) this.y = 0;
          }
        }
        draw() {
          if (this.sparkle) {
            ctx.globalAlpha = Math.random(); // parpadeo
          } else {
            ctx.globalAlpha = this.isFloating ? 0.5 : this.life / 200;
          }
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
          ctx.globalAlpha = 1;
        }
      }

      let particles = [];

      // Crear partículas flotantes iniciales
      function createFloatingParticles() {
        for (let i = 0; i < 80; i++) {
          particles.push(
            new Particle(
              Math.random() * canvas.width,
              Math.random() * canvas.height,
              ["#00bcfb", "#6fb8d6", "#ffffff"][Math.floor(Math.random() * 3)],
              Math.random() * 2 + 1,
              {
                x: (Math.random() - 0.5) * 0.2,
                y: (Math.random() - 0.5) * 0.2,
              },
              9999,
              true
            )
          );
        }
      }
      createFloatingParticles();

      // Loop de animación
      function animate() {
        requestAnimationFrame(animate);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
          p.update();
          p.draw();
          if (p.life <= 0 && !p.isFloating) particles.splice(i, 1);
        });
      }
      animate();

      // Animación del sobre
      const envelope = document.getElementById("envelope");
      const flash = document.getElementById("flash");

      setTimeout(() => {
        envelope.classList.add("zoom");

        // Flash de luz
        flash.classList.add("active");

        // Explosión de partículas mágicas
        for (let i = 0; i < 200; i++) {
          const angle = Math.random() * 2 * Math.PI;
          const speed = Math.random() * 6 + 2;
          particles.push(
            new Particle(
              canvas.width / 2,
              canvas.height / 2,
              ["#00bcfb", "#6fb8d6", "#ffffff", "#55c6ff", "#a7eaf0"][
                Math.floor(Math.random() * 5)
              ],
              Math.random() * 6 + 3,
              { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed },
              180,
              false,
              Math.random() > 0.7 // algunos brillan
            )
          );
        }

        // Redirigir al index
        setTimeout(() => {
          window.location.href = "invitacion.html";
        }, 2800);
      }, 3400); // 3 palpitaciones (3s * 3)
    </script>
  </body>
</html>
